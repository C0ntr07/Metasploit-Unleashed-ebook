<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Metasploit Exploit Format</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Metasploit
Exploit Format</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">The format of an Exploit in Metasploit
is similar to that of an Auxiliary but there are more fields.
</p>
<dl style="color: rgb(0, 0, 0);">
  <dd>
    <ul>
      <li>There is always a Payload information block. An Exploit
without a Payload is simply an Auxiliary module.
      </li>
      <li>A listing of available Targets is outlined.
      </li>
      <li>Instead of defining run(), exploit() and check() are used.
      </li>
    </ul>
  </dd>
</dl>
<h4 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="Exploit_Skeleton">Exploit Skeleton</span></h4>
<pre id="code">class Metasploit3 &lt; Msf::Exploit::Remote<br><br>      include Msf::Exploit::Remote::TCP<br><br>      def initialize<br>           super(<br>               'Name'          =&gt; 'Simplified Exploit Module',<br>               'Description'   =&gt; 'This module sends a payload',<br>               'Author'        =&gt; 'My Name Here',<br>               'Payload'       =&gt; {'Space' =&gt; 1024, 'BadChars' =&gt; &#8220;\x00&#8221;},<br>               'Targets'       =&gt; [ ['Automatic', {} ] ],<br>               'Platform'      =&gt; 'win',<br>           )<br>           register_options( [<br>               Opt::RPORT(12345)<br>           ], self.class)<br>      end<br><br>      # Connect to port, send the payload, handle it, disconnect<br>      def exploit<br>           connect()<br>           sock.put(payload.encoded)<br>           handler()<br>           disconnect()<br>      end<br>end</pre>
<h4 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="Defining_Vulnerability_Tests">Defining Vulnerability Tests</span></h4>
<p style="color: rgb(0, 0, 0);">Although it is rarely implemented, a
method called check() should be defined in your exploit modules
whenever possible.
</p>
<dl style="color: rgb(0, 0, 0);">
  <dd>
    <ul>
      <li>The check() method verifies all options except for payloads.
      </li>
      <li>The purpose of doing the check is to determine is the target
is vulnerable or not.
      </li>
      <li>Returns a defined Check value.
      </li>
    </ul>
  </dd>
</dl>
<p style="color: rgb(0, 0, 0);">The return values for check() are:
</p>
<dl style="color: rgb(0, 0, 0);">
  <dd>
    <ul>
      <li>CheckCode::Safe - not exploitable
      </li>
      <li>CheckCode::Detected - service detected
      </li>
      <li>CheckCode::Appears - vulnerable version
      </li>
      <li>CheckCode::Vulnerable - confirmed
      </li>
      <li>CheckCode::Unsupported - check is not supported for this
module.
      </li>
    </ul>
  </dd>
</dl>
<h4 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="Sample_check.28.29_Method">Sample check() Method</span></h4>
<pre id="code">def check<br>     # connect to get the FTP banner<br>     connect<br><br>     # disconnect since have cached it as self.banner<br>     disconnect<br>    <br>     case banner<br>          when /Serv-U FTP Server v4\.1/<br>               print_status('Found version 4.1.0.3, exploitable')<br>               return Exploit::CheckCode::Vulnerable<br><br>          when /Serv-U FTP Server/<br>               print_status('Found an unknown version, try it!');<br>               return Exploit::CheckCode::Detected<br><br>          else<br>               print_status('We could not recognize the server banner')<br>               return Exploit::CheckCode::Safe<br>     end<br><br>     return Exploit::CheckCode::Safe<br>end</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Exploit_Development"
 title="Exploit Development">Exploit Development</a></div>
</body>
</html>
