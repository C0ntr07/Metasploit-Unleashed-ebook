<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>WMAP Web Scanner</title>
<link rel="stylesheet" type="text/css" href="/home/steve/metasploit_unleashed/css.css" /></head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">WMAP
Web Scanner</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">WMAP is a feature-rich web
vulnerability scanner that was originally
created from a tool named SQLMap. This tool is integrated with
Metasploit and allows us to conducted webapp scanning from within the
Framework.
We begin by first creating a new database to store our scan results in,
load the <b>"wmap"</b> plugin, and run <b>"help"</b> to see what new
commands are available to us.
<br>
<br>
</p>
<pre id="code">msf &gt; db_connect root:toor@localhost/wmap<br>msf &gt; load wmap<br>[*] <br>========[ WMAP v0.9 ]=========<br>= ET  et [  ] metasploit.com =<br>==============================<br>[*] Successfully loaded plugin: wmap<br>msf &gt; help<br><br>Wmap Commands<br>=============<br><br>    Command       Description<br>    -------       -----------<br>    wmap_attack   Crawl and Test<br>    wmap_crawl    Crawl website<br>    wmap_proxy    Run mitm proxy<br>    wmap_run      Automatically test/exploit everything<br>    wmap_sql      Query the database<br>    wmap_targets  Targets in the database<br>    wmap_website  List website structure<br>...snip...</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Prior to running a scan, we first
need to add a new target URL by passing the </span><b
 style="color: rgb(0, 0, 0);">"-a"</b><span style="color: rgb(0, 0, 0);">
switch to </span><b style="color: rgb(0, 0, 0);">"wmap_targets"</b><span
 style="color: rgb(0, 0, 0);">. Afterwards, running </span><b
 style="color: rgb(0, 0, 0);">"wmap_targets -p"</b><span
 style="color: rgb(0, 0, 0);"> will print out the available targets.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; wmap_targets -h<br>[*] Usage: wmap_targets [options]<br>	-h 		Display this help text<br>	-c [url]  Crawl website (msfcrawler)<br>	-p 		Print all available targets<br>	-r 		Reload targets table<br>	-s [id]	Select target for testing<br>	-a [url]	Add new target<br><br>msf &gt; wmap_targets -a http://192.168.1.204<br>[*] Added target 192.168.1.204 80 0<br>[*] Added request / <br>msf &gt; wmap_targets -p                     <br>[*]    Id. Host					Port	SSL<br>[*]    1. 192.168.1.204                      	80	<br>[*] Done.</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Next, we select the target we wish
to scan by using the </span><b style="color: rgb(0, 0, 0);">"-s"</b><span
 style="color: rgb(0, 0, 0);"> switch. When we print out the target
list again, we can see there is an arrow pointing to our selected
target.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; wmap_targets -s 1<br>msf &gt; wmap_targets -p<br>[*]    Id. Host					Port	SSL<br>[*] =&gt; 1. 192.168.1.204                      	80	<br>[*] Done.<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Using the </span><b
 style="color: rgb(0, 0, 0);">"wmap_run"</b><span
 style="color: rgb(0, 0, 0);"> command will scan the target system. We
first using the </span><b style="color: rgb(0, 0, 0);">"-t"</b><span
 style="color: rgb(0, 0, 0);"> switch to list the modules that will be
used to scan the remote system.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; wmap_run -h<br>[*] Usage: wmap_run [options]<br>	-h		Display this help text<br>	-t		Show all matching exploit modules<br>	-e [profile]	Launch profile test modules against all matched targets.<br>			No profile runs all enabled modules.<br><br>msf &gt; wmap_run -t<br>[*] Loaded auxiliary/scanner/http/webdav_website_content ...<br>[*] Loaded auxiliary/scanner/http/http_version ...<br>[*] Loaded auxiliary/scanner/http/webdav_scanner ...<br>[*] Loaded auxiliary/scanner/http/svn_scanner ...<br>[*] Loaded auxiliary/scanner/http/soap_xml ...<br>...snip...</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">All that remains now is to actually
run the scan against our target URL.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; wmap_run -e<br>[*] Using ALL wmap enabled modules.<br>[*] Launching auxiliary/scanner/http/webdav_website_content WMAP_SERVER against 192.168.1.204:80<br><br>[*] Found file or directory in WebDAV response (192.168.1.204) http://192.168.1.204/<br>[*] Scanned 1 of 1 hosts (100% complete)<br>[*] Launching auxiliary/scanner/http/http_version WMAP_SERVER against 192.168.1.204:80<br>[*] 192.168.1.204 Microsoft-IIS/6.0<br>...snip...<br>[*] Scanned 1 of 1 hosts (100% complete)<br>[*] Launching auxiliary/scanner/http/dir_listing WMAP_DIR / against 192.168.1.204:80...<br>[*] Scanned 1 of 1 hosts (100% complete)<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Once the scan has finished
executing, we take a look at the database to see if wmap found anything
of interest.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; db_hosts -c address,svcs,vulns<br><br>Hosts<br>=====<br><br>address        svcs  vulns<br>-------        ----  -----<br>192.168.1.204  1     1<br><br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Looking at the above output, we can
see that wmap has reported on 1 vulnerability. Running </span><b
 style="color: rgb(0, 0, 0);">"db_vulns"</b><span
 style="color: rgb(0, 0, 0);"> will list the details for us.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; db_vulns<br>[*] Time: Thu Nov 25 00:50:27 UTC 2010 Vuln: host=192.168.1.204 port=80 proto=tcp name=HTTP-TRACE-ENABLED refs=BAhbByIIQ1ZFIg4yMDA1LTMzOTg=<br>,BAhbByIIQ1ZFIg4yMDA1LTM0OTg=<br>,BAhbByIKT1NWREIiCDg3Nw==<br>,BAhbByIIQklEIgoxMTYwNA==<br>,BAhbByIIQklEIgk5NTA2<br>,BAhbByIIQklEIgk5NTYx<br><br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">The vulnerability information is
encoded in base64-format so we will need to decode. We can use openssl
for this.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre id="code">msf &gt; echo "BAhbByIIQ1ZFIg4yMDA1LTMzOTg=" | openssl base64 -d<br>[*] exec: echo "BAhbByIIQ1ZFIg4yMDA1LTMzOTg=" | openssl base64 -d<br><br>[CVE"2005-3398 <br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We can now use this information to
gather further information on the
reported vulnerability. As pentesters, we would want to investigate
each finding further and identify if there are potential methods for
attack.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Vulnerability_Scanning"
 title="Vulnerability Scanning">Vulnerability Scanning</a></div>
</body>
</html>
