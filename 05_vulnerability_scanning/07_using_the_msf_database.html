<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Using the MSF Database</title>
</head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Using
the MSF Database</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);"><br>
Now that we have run some scans, our database should be populated with
some initial data so now is a good time to cover how to pull
information from the Metasploit database.
</p>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_hosts">db_hosts</span></h3>
<p style="color: rgb(0, 0, 0);">The <b>"db_hosts"</b> run without any
parameters will list all of the hosts in the database.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_hosts<br><br>Hosts<br>=====<br><br>address         address6  arch  comm  comments  created_at                    info  mac                name  os_flavor  os_lang  os_name  os_sp  purpose  state  updated_at                    svcs  vulns  workspace<br>-------         --------  ----  ----  --------  ----------                    ----  ---                ----  ---------  -------  -------  -----  -------  -----  ----------                    ----  -----  ---------<br>192.168.69.100                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:DE:1A:00                                                     alive  Tue Nov 23 07:43:55 UTC 2010  4     0      default<br>192.168.69.105                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:9A:FC:E0                                                     alive  Tue Nov 23 07:43:55 UTC 2010  4     0      default<br>192.168.69.110                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:69:9C:44                                                     alive  Tue Nov 23 07:43:55 UTC 2010  6     0      default<br>192.168.69.125                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:F5:00:71                                                     alive  Tue Nov 23 07:43:55 UTC 2010  1     0      default<br>192.168.69.130                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:6E:26:BB                                                     alive  Tue Nov 23 07:43:55 UTC 2010  14    0      default<br>192.168.69.135                                  Tue Nov 23 07:43:55 UTC 2010        00:0C:29:AC:BC:A5                                                     alive  Tue Nov 23 07:43:55 UTC 2010  12    0      default<br>192.168.69.140                                  Tue Nov 23 07:43:56 UTC 2010                                                                              alive  Tue Nov 23 07:43:56 UTC 2010  1     0      default<br>192.168.69.141                                  Tue Nov 23 07:43:56 UTC 2010        00:0C:29:F3:40:70                                                     alive  Tue Nov 23 07:43:56 UTC 2010  12    0      default<br>192.168.69.142                                  Tue Nov 23 07:43:56 UTC 2010        00:0C:29:57:63:E2                                                     alive  Tue Nov 23 07:43:56 UTC 2010  14    0      default<br>192.168.69.143                                  Tue Nov 23 07:43:56 UTC 2010        00:0C:29:32:29:79                                                     alive  Tue Nov 23 07:43:56 UTC 2010  11    0      default<br>192.168.69.146                                  Tue Nov 23 07:43:56 UTC 2010        00:0C:29:97:C4:27                                                     alive  Tue Nov 23 07:43:56 UTC 2010  2     0      default<br>192.168.69.171                                  Tue Nov 23 07:43:56 UTC 2010        00:0C:29:EC:23:47                                                     alive  Tue Nov 23 07:43:56 UTC 2010  6     0      default<br>192.168.69.173                                  Tue Nov 23 07:43:57 UTC 2010        00:0C:29:45:7D:33                                                     alive  Tue Nov 23 07:43:57 UTC 2010  3     0      default<br>192.168.69.175                                  Tue Nov 23 07:43:57 UTC 2010        00:0C:29:BB:38:53                                                     alive  Tue Nov 23 07:43:57 UTC 2010  4     0      default<br>192.168.69.199                                  Tue Nov 23 07:43:57 UTC 2010        00:0C:29:58:09:DA                                                     alive  Tue Nov 23 07:43:57 UTC 2010  4     0      default<br>192.168.69.50                                   Tue Nov 23 07:43:55 UTC 2010        00:0C:29:2A:02:5B                                                     alive  Tue Nov 23 07:43:55 UTC 2010  3     0      default</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We can also further narrow down the
output to display only the columns we are interested in.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; db_hosts -c address,state,svcs<br><br>Hosts<br>=====<br><br>address         state  svcs<br>-------         -----  ----<br>192.168.69.100  alive  4<br>192.168.69.105  alive  4<br>192.168.69.110  alive  6<br>192.168.69.125  alive  1<br>192.168.69.130  alive  14<br>192.168.69.135  alive  12<br>192.168.69.140  alive  1<br>192.168.69.141  alive  12<br>192.168.69.142  alive  14<br>192.168.69.143  alive  11<br>192.168.69.146  alive  2<br>192.168.69.171  alive  6<br>192.168.69.173  alive  3<br>192.168.69.175  alive  4<br>192.168.69.199  alive  4<br>192.168.69.50   alive  3</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We can also limit the output to a
single host.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; db_hosts -a 192.168.69.50 -c address,mac,svcs<br><br>Hosts<br>=====<br><br>address        mac                svcs<br>-------        ---                ----<br>192.168.69.50  00:0C:29:2A:02:5B  3<br><br>msf &gt;</pre>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_notes">db_notes</span></h3>
<p style="color: rgb(0, 0, 0);">Running <b>"db_notes"</b> will output
the notes that Metasploit has
for each host. This is where you will find the results of your Nmap
scan, along with lots of other valuable information. Like the db_hosts
command, you can filter the information to display only the notes about
a single host.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_notes -a 192.168.69.135<br>[*] Time: Tue Nov 23 07:43:55 UTC 2010 Note: host=192.168.69.135 type=host.os.nmap_fingerprint data={:os_version=&gt;"2.6.X", :os_accuracy=&gt;"100", :os_match=&gt;"Linux 2.6.9 - 2.6.31", :os_vendor=&gt;"Linux", :os_family=&gt;"Linux"}<br>[*] Time: Tue Nov 23 07:43:56 UTC 2010 Note: host=192.168.69.135 type=host.last_boot data={:time=&gt;"Sun Nov 21 23:23:54 2010"}<br>[*] Time: Tue Nov 23 07:54:48 UTC 2010 Note: host=192.168.69.135service=smb type=smb.fingerprint data={:os_flavor=&gt;"Unix", :os_name=&gt;"Unknown", :os_sp=&gt;"Samba 3.0.20-Debian"}<br>msf &gt;</pre>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_services">db_services</span></h3>
<p style="color: rgb(0, 0, 0);">The <b>"db_services"</b> command will,
as you can imagine, display
the identified services on the target machines. This is the information
that will provide us with valuable information with respect to what
targets merit further attack.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_services <br><br>Services<br>========<br><br>created_at                    info                                                                                                 name           port   proto  state  updated_at                    Host            Workspace<br>----------                    ----                                                                                                 ----           ----   -----  -----  ----------                    ----            ---------<br>Tue Nov 23 07:43:55 UTC 2010  Microsoft Windows RPC                                                                                msrpc          135    tcp    open   Tue Nov 23 07:43:55 UTC 2010  192.168.69.100  default<br>Tue Nov 23 07:43:55 UTC 2010                                                                                                       netbios-ssn    139    tcp    open   Tue Nov 23 07:43:55 UTC 2010  192.168.69.100  default<br>Tue Nov 23 07:43:55 UTC 2010  Windows XP Service Pack 2 (language: English) (name:V-XPSP2-TEMPLAT) (domain:WORKGROUP)              smb            445    tcp    open   Tue Nov 23 07:54:50 UTC 2010  192.168.69.100  default<br>...snip...<br>Tue Nov 23 07:43:55 UTC 2010  lighttpd 1.4.26                                                                                      ip             80     tcp    open   Tue Nov 23 07:55:42 UTC 2010  192.168.69.50   default<br>Tue Nov 23 07:43:55 UTC 2010  Samba smbd 3.X workgroup: WORKGROUP                                                                  netbios-ssn    139    tcp    open   Tue Nov 23 07:43:55 UTC 2010  192.168.69.50   default<br>Tue Nov 23 07:43:55 UTC 2010  Unix Samba 3.0.37 (language: Unknown) (domain:WORKGROUP)                                             smb            445    tcp    open   Tue Nov 23 07:54:41 UTC 2010  192.168.69.50   default<br><br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We also have the option of narrowing
down the information on our target. Passing </span><b
 style="color: rgb(0, 0, 0);">"-h"</b><span style="color: rgb(0, 0, 0);">
will display the available options.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; db_services -h<br><br>Usage: db_services [-h|--help] [-u|--up] [-a ] [-r ] [-p ] [-n ]<br><br>  -a   Search for a list of addresses<br>  -c     Only show the given columns<br>  -h,--help         Show this help information<br>  -n   Search for a list of service names<br>  -p   Search for a list of ports<br>  -r      Only show [tcp|udp] services<br>  -u,--up           Only show services which are up<br><br>Available columns: created_at, info, name, port, proto, state, updated_at<br><br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">We can filter down the output all
the way down to a particular TCP port that we are looking for.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; db_services -a 192.168.69.135 -c info -p 445 -r tcp<br><br>Services<br>========<br><br>info                                                             Host            Workspace<br>----                                                             ----            ---------<br>Unix Samba 3.0.20-Debian (language: Unknown) (domain:WORKGROUP)  192.168.69.135  default<br><br>msf &gt;</pre>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_vulns">db_vulns</span></h3>
<p style="color: rgb(0, 0, 0);">Running <b>"db_vulns"</b> will list
all of the vulnerabilities
stored in the database, matched to each target. It will also list the
appropriate references if available.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_vulns -h<br>[*] Time: Tue Nov 23 09:09:19 UTC 2010 Vuln: host=192.168.69.50 name=NSS- refs=<br>[*] Time: Tue Nov 23 09:09:20 UTC 2010 Vuln: host=192.168.69.50 port=445 proto=tcp name=NSS-26920 refs=CVE-1999-0519,CVE-1999-0520,CVE-2002-1117,BID-494,OSVDB-299<br>[*] Time: Tue Nov 23 09:09:21 UTC 2010 Vuln: host=192.168.69.50 port=445 proto=tcp name=NSS-26919 refs=CVE-1999-0505<br>...snip...<br>[*] Time: Tue Nov 23 09:18:54 UTC 2010 Vuln: host=192.168.69.1 name=NSS-43067 refs=<br>[*] Time: Tue Nov 23 09:18:54 UTC 2010 Vuln: host=192.168.69.1 name=NSS-45590 refs=<br>[*] Time: Tue Nov 23 09:18:54 UTC 2010 Vuln: host=192.168.69.1 name=NSS-11936 refs=<br>msf &gt;</pre>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_exploited">db_exploited</span></h3>
<p style="color: rgb(0, 0, 0);">Once we have had some fun and gotten
shells on some of our targets, we can run <b>"db_exploited"</b> to
list the machines that were successfully exploited along with what
exploit was used on them.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_exploited <br>[*] Time: Tue Nov 23 09:23:44 UTC 2010 Host Info: host=192.168.69.100 port=445 proto=tcp sname=192.168.69.100 exploit=exploit/windows/smb/ms08_067_netapi<br>[*] Time: Tue Nov 23 09:23:44 UTC 2010 Host Info: host=192.168.69.105 port=445 proto=tcp sname=192.168.69.105 exploit=exploit/windows/smb/ms08_067_netapi<br>[*] Found 2 exploited hosts.<br>msf &gt;</pre>
<h3 style="color: rgb(0, 0, 0);"> <span class="mw-headline"
 id="db_add_cred_and_db_creds">db_add_cred and db_creds</span></h3>
<p style="color: rgb(0, 0, 0);">During post-exploitation of a host,
gathering user credentials is an
important activity in order to further penetrate a target network. As
we gather sets of credentials, we can add them to our database with the
<b>"db_add_creds"</b> command and list them later by running <b>"db_creds"</b>.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; db_add_cred <br>[*] Usage: db_add_cred [host] [port] [user] [pass] [type] [active]<br>msf &gt; db_add_cred 192.168.69.100 445 Administrator 7bf4f254b222bb24aad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e:::<br>[*] Time: Tue Nov 23 09:28:24 UTC 2010 Credential: host=192.168.69.100 port=445 proto=tcp sname=192.168.69.100 type=password user=Administrator pass=7bf4f254b222bb24aad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e::: active=true<br>msf &gt; db_creds<br>[*] Time: Tue Nov 23 09:28:24 UTC 2010 Credential: host=192.168.69.100 port=445 proto=tcp sname=192.168.69.100 type=password user=Administrator pass=7bf4f254b222bb24aad3b435b51404ee:2892d26cdf84d7a70e2eb3b9f05c425e::: active=true<br>[*] Found 1 credential.<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">This has just been a brief overview
of some of the major database
commands available within Metasploit. As always, the best way to learn
more and become proficient is to experiment with them in your lab
environment.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Vulnerability_Scanning"
 title="Vulnerability Scanning">Vulnerability Scanning</a></div>
</body>
</html>
