<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta content="text/html; charset=ISO-8859-1"
 http-equiv="Content-Type">
  <title>Nessus Via Msfconsole</title>
</head>
<body>
<h1 style="color: rgb(0, 0, 0);" id="firstHeading" class="firstHeading">Nessus
Via Msfconsole</h1>
<h3 style="color: rgb(0, 0, 0);" id="siteSub">From Metasploit Unleashed
- Mastering The Framework</h3>
<p style="color: rgb(0, 0, 0);">For those situations where we choose to
remain at the command line,
there is also the option to connect to a Nessus version 4.2.x server
directly from within msfconsole. The Nessus Bridge, written by Zate and
covered in detail at <a
 href="http://blog.zate.org/2010/09/26/nessus-bridge-for-metasploit-intro/"
 class="external free" rel="nofollow">http://blog.zate.org/2010/09/26/nessus-bridge-for-metasploit-intro/</a>
uses xmlrpc to connect to a server instance of Nessus, allowing us to
perform and import a vulnerability scan rather than doing a manual
import.
</p>
<p style="color: rgb(0, 0, 0);">We begin by first loading the Nessus
Bridge plugin. Running
'nessus_help' will display the commands available to us. As you can
see, it is quite full-featured.
<br>
<br>
</p>
<pre style="color: rgb(0, 0, 0);">msf &gt; load nessus<br>[*] Nessus Bridge for Nessus 4.2.x<br>[+] Type nessus_help for a command listing<br>[*] Successfully loaded plugin: nessus<br>msf &gt; nessus_help<br>[+] Nessus Help<br>[+] type nessus_help command for help with specific commands<br><br>Command                    Help Text<br>-------                    ---------<br>Generic Commands          <br>-----------------          -----------------<br>nessus_connect             Connect to a nessus server<br>nessus_logout              Logout from the nessus server<br>nessus_help                Listing of available nessus commands<br>nessus_server_status       Check the status of your Nessus Server<br>nessus_admin               Checks if user is an admin<br>nessus_server_feed         Nessus Feed Type<br>nessus_find_targets        Try to find vulnerable targets from a report<br>                          <br>Reports Commands          <br>-----------------          -----------------<br>nessus_report_list         List all Nessus reports<br>nessus_report_get          Import a report from the nessus server in Nessus v2 format<br>nessus_report_hosts        Get list of hosts from a report<br>nessus_report_host_ports   Get list of open ports from a host from a report<br>nessus_report_host_detail  Detail from a report item on a host<br>                          <br>Scan Commands             <br>-----------------          -----------------<br>nessus_scan_new            Create new Nessus Scan<br>nessus_scan_status         List all currently running Nessus scans<br>...snip...</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">Prior to beginning, we need to
connect to the Nessus server on our
network. Note that we need to add 'ok' at the end of the connection
string to acknowledge the risk of man-in-the-middle attacks being
possible.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; nessus_connect dook:s3cr3t@192.168.1.100<br>[-] Warning: SSL connections are not verified in this release, it is possible for an attacker<br>[-]          with the ability to man-in-the-middle the Nessus traffic to capture the Nessus<br>[-]          credentials. If you are running this on a trusted network, please pass in 'ok'<br>[-]          as an additional parameter to this command.<br>msf &gt; nessus_connect dook:s3cr3t@192.168.1.100 ok<br>[*] Connecting to https://192.168.1.100:8834/ as dook<br>[*] Authenticated<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">To see the scan policies that are
available on the server, we issue
the 'nessus_policy_list' command. If there are not any policies
available, this means that you will need to connect to the Nessus GUI
and create one before being able to use it.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; nessus_policy_list<br>[+] Nessus Policy List<br><br>ID  Name       Owner  visability<br>--  ----       -----  ----------<br>1   the_works  dook   private<br><br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">To run a Nessus scan using our
existing policy, using the command
'nessus_scan_new' followed by the policy ID number, a name for your
scan, and the target.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; nessus_scan_new<br>[*] Usage:<br>[*]        nessus_scan_new policy id scan name targets<br>[*]        use nessus_policy_list to list all available policies<br>msf &gt; nessus_scan_new 1 pwnage 192.168.1.161<br>[*] Creating scan from policy number 1, called "pwnage" and scanning 192.168.1.161<br>[*] Scan started.  uid is 9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">To see the progress of our scan, we
run 'nessus_scan_status'. Note
that there is not a progress indicator so we keep running the command
until we see the message 'No Scans Running'.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; nessus_scan_status<br>[+] Running Scans<br><br>Scan ID                                               Name    Owner  Started            Status   Current Hosts  Total Hosts<br>-------                                               ----    -----  -------            ------   -------------  -----------<br>9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f  pwnage  dook   19:39 Sep 27 2010  running  0              1<br><br><br>[*] You can:<br>[+]         Import Nessus report to database :     nessus_report_get reportid<br>[+]         Pause a nessus scan :             nessus_scan_pause scanid<br>msf &gt; nessus_scan_status<br>[*] No Scans Running.<br>[*] You can:<br>[*]         List of completed scans:         nessus_report_list<br>[*]         Create a scan:                   nessus_scan_new policy id scan name target(s)<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">When Nessus completes the scan, it
generates a report for us with
the results. To view the list of available reports, we run the
'nessus_report_list' command. To import a report, we run </span><b
 style="color: rgb(0, 0, 0);">"nessus_report_get"</b><span
 style="color: rgb(0, 0, 0);"> followed by the report ID.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; nessus_report_list<br>[+] Nessus Report List<br><br>ID                                                    Name    Status     Date<br>--                                                    ----    ------     ----<br>9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f  pwnage  completed  19:47 Sep 27 2010<br><br>[*] You can:<br>[*]         Get a list of hosts from the report:          nessus_report_hosts report id<br>msf &gt; nessus_report_get<br>[*] Usage:<br>[*]        nessus_report_get report id<br>[*]        use nessus_report_list to list all available reports for importing<br>msf &gt; nessus_report_get 9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f<br>[*] importing 9d337e9b-82c7-89a1-a194-4ef154b82f624de2444e6ad18a1f<br>msf &gt;</pre>
<br style="color: rgb(0, 0, 0);">
<span style="color: rgb(0, 0, 0);">With the report imported, we can
list the hosts and vulnerabilities just as we could when importing a
report manually.
</span><br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<pre style="color: rgb(0, 0, 0);">msf &gt; db_hosts -c address,vulns<br><br>Hosts<br>=====<br><br>address        vulns<br>-------        -----<br>192.168.1.161  33<br><br>msf &gt; db_vulns<br>[*] Time: 2010-09-28 01:51:37 UTC Vuln: host=192.168.1.161 port=3389 proto=tcp name=NSS-10940 refs=<br>[*] Time: 2010-09-28 01:51:37 UTC Vuln: host=192.168.1.161 port=1900 proto=udp name=NSS-35713 refs=<br>[*] Time: 2010-09-28 01:51:37 UTC Vuln: host=192.168.1.161 port=1030 proto=tcp name=NSS-22319 refs=<br>[*] Time: 2010-09-28 01:51:37 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-10396 refs=<br>[*] Time: 2010-09-28 01:51:38 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-10860 refs=CVE-2000-1200,BID-959,OSVDB-714<br>[*] Time: 2010-09-28 01:51:38 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-10859 refs=CVE-2000-1200,BID-959,OSVDB-715<br>[*] Time: 2010-09-28 01:51:39 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-18502 refs=CVE-2005-1206,BID-13942,IAVA-2005-t-0019<br>[*] Time: 2010-09-28 01:51:40 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-20928 refs=CVE-2006-0013,BID-16636,OSVDB-23134<br>[*] Time: 2010-09-28 01:51:41 UTC Vuln: host=192.168.1.161 port=445 proto=tcp name=NSS-35362 refs=CVE-2008-4834,BID-31179,OSVDB-48153<br>[*] Time: 2010-09-28 01:51:41 UTC Vuln: host=192.168.1.161<br>...snip...</pre>
<br style="color: rgb(0, 0, 0);">
<br style="color: rgb(0, 0, 0);">
<div style="text-align: center; color: rgb(0, 0, 0);"><a
 href="http://www.offensive-security.com/metasploit-unleashed/Working_With_Nessus"
 title="Working With Nessus">Working with Nessus</a></div>
</body>
</html>
